## 패키지 구조 및 설명
패키지 구조
> hello.login
> > domain
> > > item
> > > member
> > > login

> > web
> > > item
> > > member
> > > login<br>

#### 도메인이 가장 중요
화면, UI, 기술 인프라 등등의 영역은 제외한 시스템이 구현해야 하는 핵심 비즈니스 업무 영역을 말함<br>

web은 domain을 알고 있어야하지만 domain은 web을 모르도록 설계해야함<br>
향후 web이 바뀌더라도 핵심 비즈니스 로직인 domaind이 그대로 있다면 유지보수하기가 수월하기 때문.<br>

#### 서비스는 핵심 비즈니스 로직을 구현, 레포지토리는 DB의 값을 원하는 형태로 가공하여 전달하는 역할<br>

## 회원가입
쿠키세션 pdf 7p 코드 참고<br>
람다식변경 전후 코드 비교<br>
변경전
```
public Optional<Member> findByLoginId(String loginId) {
  List<Member> all = findAll();
  for (Member m : all) {
    if (m.getLoginId().equals(loginId)) {
      return Optional.of(m);
    }
  }
}
```
변경후
```
public Optional<Member> findByLoginId(String loginId) {
 return findAll().stream()
 .filter(m -> m.getLoginId().equals(loginId))
 .findFirst();
}
```
설명<br>
> findAll().stream() = findAll();<br>
> .filter(m -> m.getLoginId().equals(loginId)) = if문<br>
> .findFirst(); = 먼저 나온 값부터 'm'에 넣는다는 의미<br>
> 최종값을 Optional<Member>에 저장<br>

#### 테스트
```
@PostConstruct
 public void init() {
   Member member = new Member();
   member.setLoginId("test");
   member.setPassword("test!");
   member.setName("테스터");
   memberRepository.save(member);
 }
```
결과는 로그에서 확인 가능<br>

## 로그인 기능
서비스에서 비밀번호 일치 여부 확인<br>
람다식 변경 전
```
public Member login(String loginId, String password) {
  Optional<Member> findMemberOptional = memberRepository.findByLongId(lognId);
  Member member = findMemberOptional.get();
  if (member.getPasswrod().equals(password)) {
    return member;
  } else {
    return null;
  }
}
```
변경 후(findByLoginId 메서드가 Optional 타입이라 람다식 사용 가능)
```
public Member login(String loginId, String password) {
   return memberRepository.findByLoginId(loginId)
   .filter(m -> m.getPassword().equals(password))
   .orElse(null);
}
```
컨트롤러는 서비스에서 처리한 값에 대한 결과를 핸들링 해줌<br>
여기서는 서비스에서 비밀번호가 맞지 않았을 때 null을 반환하도록 구현했기 때문에<br>
만약 null값이 입력되면  bindingResult.reject("loginFail", "아이디 또는 비밀번호가 맞지 않습니다.")를 사용해서 error를 loginForm.html에 뿌려지도록 함(글로벌 오류)
```
if (loginMember == null) {
 bindingResult.reject("loginFail", "아이디 또는 비밀번호가 맞지 않습니다.");
 return "login/loginForm";
 }
```
<br>
