# 프로젝트 생성
아래 사이트에서 스프링 프로젝트를 생성한다.
`https://start.spring.io`


# 설계
## 회원 도메인을 설계
클라이언트 -> 회원서비스(회원가입, 회원조회) -> 회원 저장소 -> 메모리 회원 저장소, DB 회원 저장소, 외부 시스템 연동 회원 저장소 (미정)

## 클래스 다이어그램 예시
MemberService(<-MemberServiceImpl) -> MemberRepository(<-MemoryMemberRepository, DbMemberRepository)

## 객체 다이어그램 예시
클라이언트 -> 회원 서비스 -> 메모리 회원 저장소

# 회원 도메인 개발
1. 회원 등급을 enum 타입으로 선언한다.(enum 클래스 생성)

2. 필드가 id, name, grade인 Member 클래스(회원 엔티티)를 생성한다.

3. 회원 저장소 인터페이스를 생성한다. 

4. 회원 저장소를 구현하는 메모리 회원 저장소 구현 클래스를 생성하고 인터페이스 추상 메서드를 오버라이딩하여 구체적인 동작을 구현한다.

구현 내용(현재는 데이터 저장방식을 정하지 않았으므로 메모리에 저장한다.)
```
public void save(Member member) {
	store.put(member.getId(), member);
}
public Member findById(Long memberId) {
	return store.get(memberId);
}
```

5. 회원 서비스 인터페이스를 생성한다.

6. 회원서비스 구현체를 생성한다.

구현 내용
```
public void join(Member member) {
	memberRepository.save(member);
}
public Member findMember(Long memberId) {
	return memberRepository.findById(memberId);
}
```

## 어플리케이션 로직 테스트
회원 도메인을 실행하기 위해 main에서 값을 넣는다.
`Member member = new Member(1L, "memberA", Grade.VIP);`
서비스에 연결해 결과를 출력한다.
`memberService.join(member);`
`System.out.println("new member = " + member.getName());`
`System.out.println("find Member = " + findMember.getName());`

## 테스트 코드를 이용한 테스트
test 폴더에서 given, when, then을 이용해 테스트 코드를 작성한다.
```
@Test
void join() {
	//given
	Member member = new Member(1L, "memberA", Grade.VIP);
	//when
	memberService.join(member);
	Member findMember = memberService.findMember(1L);
	//then
	Assertions.assertThat(member).isEqualTo(findMember);
```

## 회원 도메인 설계의 문제점
다른 저장소로 변경할 때 OCP 원칙이 지켜지지 않는다.
의존관계가 인터페이스 뿐 아니라 구현까지 모두 의존하고 있다.

# 주문과 할인 도메인 설계
## 주문 도메인 객체 다이어그램
1. 클라이언트 -> 주문 서비스 구현체 -> 메모리 회원 저장소, 정액 할인 정책
-> 회원을 메모리에서 조회하고 정액 할인 정책을 지원해도 주문 서비스는 변경하지 않아도 된다. 역할들의 협력 관계를 그대로 재사용할 수 있다.

2. 클라이언트 -> 주문 서비스 구현체 -> DB 회원 저장소, 정률 할인 정책
회원을 메모리가 아닌 실제 DB에서 조회하고, 정률 할인 정책(주문 금액에 따라 % 할인)을 지원해도 주문 서비스를 변경하지 않아도 된다.
협력 관계를 그대로 재사용 할 수 있다.

# 개발
1. 할인 정책 인터페이스를 생성한다.
2. 구현체를 생성한다.
코드 예시
```
@Override
  public int discount(Member member, int price) {
    if (member.getGrade() == Grade.VIP) {
    return discountFixAmount;
  } else {
  	return 0;
  }
}
```

3. memberId, itemName, itemPrice, dicountPrice 를 필드로 가진 주문 엔티티를 생성한다.

4. 주문 서비스 인터페이스를 생성한다.

5. 구현체를 생성한다.
코드 예시
```
@Override
public Order createOrder(Long memberId, String itemName, int itemPrice) {
  Member member = memberRepository.findById(memberId);
  int discountPrice = discountPolicy.discount(member, itemPrice);
  return new Order(memberId, itemName, itemPrice, discountPrice);
}
```
주문 생성 요청이 오면 회원 정보를 조회한 뒤 할인 정책을 적용해 주문 객체를 생성하고 반환한다. 메모리 회원 리포지토리와 고정 금액 할인 정책을 구현체로 생성한다.

## 테스트
주문 할인 정책 테스트
```
@Test
void createOrder() {
  long memberId = 1L;
  Member member = new Member(memberId, "memberA", Grade.VIP);
  memberService.join(member);
  Order order = orderService.createOrder(memberId, "itemA", 10000);
  Assertions.assertThat(order.getDiscountPrice()).isEqualTo(1000);
}
```
